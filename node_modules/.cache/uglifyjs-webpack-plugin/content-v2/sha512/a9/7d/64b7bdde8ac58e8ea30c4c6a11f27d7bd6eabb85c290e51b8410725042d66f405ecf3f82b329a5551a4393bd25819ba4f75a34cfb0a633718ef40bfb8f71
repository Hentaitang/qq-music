{"code":"!function(e){var s={};function t(i){if(s[i])return s[i].exports;var n=s[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}t.m=e,t.c=s,t.d=function(e,s,i){t.o(e,s)||Object.defineProperty(e,s,{enumerable:!0,get:i})},t.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},t.t=function(e,s){if(1&s&&(e=t(e)),8&s)return e;if(4&s&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&s&&\"string\"!=typeof e)for(var n in e)t.d(i,n,function(s){return e[s]}.bind(null,n));return i},t.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(s,\"a\",s),s},t.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)},t.p=\"\",t(t.s=1)}([function(e,s){document.addEventListener(\"click\",function(e){let s=e.target;if(\"tab\"!==s.dataset.role)return;[].forEach.call(s.parentElement.children,e=>{e.classList.remove(\"active\")}),s.classList.add(\"active\");let t=document.querySelector(s.dataset.view);t&&([].forEach.call(t.parentElement.children,e=>{e.style.display=\"none\"}),t.style.display=\"block\")})},function(e,s,t){\"use strict\";t.r(s);t(0);const i=\"https://qq-music-api.now.sh\",n=\"https://qq-music-api.now.sh/top\";function r(e){let s=[].slice.call(e);if(\"IntersectionObserver\"in window){let e=new IntersectionObserver(function(s){s.forEach(s=>{s.intersectionRatio>0&&t(s.target,()=>{e.unobserve(s.target)})})},{threshold:.01});s.forEach(s=>e.observe(s))}else{let e=function(e,s){let t,i;return function n(){let r=Date.now(),a=r-t;!t||a>=s?(e(),t=r):a<s&&(clearTimeout(i),i=setTimeout(n,s-a))}}(function(){if(0===s.length)return window.removeEventListener(\"scroll\",e);(s=s.filter(e=>e.classList.contains(\"lazyload\"))).forEach(e=>{(function(e){let{top:s,left:t,right:i,bottom:n}=e.getBoundingClientRect(),r=document.documentElement.clientHeight,a=document.documentElement.clientWidth;return(s>0&&s<r||n>0&&n<r)&&(t>0&&t<a||i>0&&i<a)})(e)&&t(e)})},500);window.addEventListener(\"scroll\",e),window.dispatchEvent(new Event(\"scroll\"))}function t(e,s){let t=new Image;t.src=e.dataset.src,t.onload=function(){e.src=t.src,e.classList.remove(\"lazyload\")},\"function\"==typeof s&&s()}}class a{constructor(e={}){this.$el=e.el,this.slides=e.slides,this.render()}render(){this.$el.innerHTML='\\n        <div class=\"qq-slider-wrap\">\\n            <div class=\"swiper-container\">\\n                <div class=\"swiper-wrapper\">\\n                </div>\\n                <div class=\"swiper-pagination\"></div>\\n            </div>\\n        </div>\\n        ',this.$wrap=this.$el.querySelector(\".swiper-wrapper\"),this.$wrap.innerHTML=this.slides.map(e=>`<div class=\"swiper-slide\">\\n                <div class=\"qq-slider-item\">\\n                    <a href=\"${e.link}\">\\n                        <img src=\"${e.image}\">\\n                    </a>\\n                </div>\\n            </div>\\n            `).join(\"\")}}class l{constructor(e,s){this.$el=e,this.$el.innerHTML='<div class=\"player-lyrics-lines\"></div>',this.$lines=this.$el.querySelector(\".player-lyrics-lines\"),this.text=\"\",this.index=0,this.lyrics=[],this.elapsed=0,this.$audio=s,this.reset(this.text)}start(){this.intervalName=setInterval(this.update.bind(this),1e3)}pause(){clearInterval(this.intervalName)}update(){if(this.elapsed=Math.round(this.$audio.currentTime),this.index===this.lyrics.length-1)return this.reset();for(let e=this.index+1;e<this.lyrics.length;e++){let s=this.getSeconds(this.lyrics[e]);if(this.elapsed===s&&(!this.lyrics[e+1]||this.elapsed<this.getSeconds(this.lyrics[e+1]))){this.$lines.children[this.index].classList.remove(\"active\"),this.$lines.children[e].classList.add(\"active\"),this.index=e;break}}if(this.index>2){let e=-(this.index-2)*this.LINE_HEIGHT;this.$lines.style.transform=`translateY(${e}px)`}}render(){let e=this.lyrics.map(e=>`\\n            <div class=\"player-lyrics-line\">${e.slice(10)}</div>\\n        `).join(\"\");this.$lines.innerHTML=e}reset(e){e&&(this.text=this.formatText(e)||\"\",this.lyrics=this.text.match(/^\\[\\d{2}:\\d{2}\\.\\d{2}\\](.+)$/gm)||[],this.lyrics.length&&(this.render(),this.$lines.children[this.index].classList.remove(\"active\"),this.$lines.children[0].classList.add(\"active\"),this.$lines.style.transform=\"translateY(0px)\")),this.pause(),this.index=0,this.elapsed=0}restart(){this.reset(),this.start()}getSeconds(e){return+e.replace(/^\\[(\\d{2}):(\\d{2}).*/,(e,s,t)=>60*+s+ +t)}formatText(e){let s=document.createElement(\"div\");return s.innerHTML=e,s.innerText}}l.prototype.LINE_HEIGHT=42;class o{constructor(e,s,t){this.$el=e,this.elapsed=0,this.duration=s||0,this.progress=0,this.render(),this.$progress=this.$el.querySelector(\".progress-action\"),this.$elapsed=this.$el.querySelector(\".progress-elapsed\"),this.$duration=this.$el.querySelector(\".progress-duration\"),this.$elapsed.innerHTML=this.formatTime(this.elapsed),this.$duration.innerHTML=this.formatTime(this.duration),t&&this.start()}start(){this.intervalName=setInterval(this.update.bind(this),50)}pause(){clearInterval(this.intervalName)}update(){this.elapsed+=.05,this.elapsed>=this.duration&&this.reset(),this.progress=this.elapsed/this.duration,this.$progress.style.transform=`translateX(${100*this.progress-100}%)`,this.$elapsed.innerText=this.formatTime(this.elapsed)}reset(e){this.pause(),this.elapsed=0,this.progress=0,e&&(this.duration=e,this.$duration.innerText=this.formatTime(this.duration),this.$elapsed.innerText=this.formatTime(this.elapsed),this.$progress.style.transform=\"translateX(-100%)\")}render(){this.$el.innerHTML='\\n        <div class=\"progress-time progress-elapsed\"></div>\\n        <div class=\"progress-bar\">\\n            <div class=\"progress-action\"></div>\\n        </div>\\n        <div class=\"progress-time progress-duration\"></div> \\n        '}formatTime(e){let s=Math.floor(e/60),t=Math.floor(e%60);return s<10&&(s=\"0\"+s),t<10&&(t=\"0\"+t),`${s}:${t}`}}t.d(s,\"swiper\",function(){return h});new class{constructor(e){this.$el=e}launch(){return fetch(i).then(e=>e.json()).then(e=>{this.render(e)}).then(()=>this.loading()),this}render(e){this.renderSlider(e.data.slider),h(),this.renderRadio(e.data.radioList),this.renderSong(e.data.songList),r(this.$el.querySelectorAll(\".lazyload\"))}loading(){let e=this.$el.querySelector(\"#loading\"),s=document.querySelector(\"#body\");e.classList.add(\"hidden\"),s.classList.remove(\"all-load\")}renderSlider(e){e=e.map(e=>({link:e.linkUrl,image:e.picUrl})),new a({el:this.$el.querySelector(\"#slider\"),slides:e})}renderRadio(e){this.$el.querySelector(\".radio .list\").innerHTML=e.map(e=>`<div class=\"list-item\">\\n            <div class=\"list-media\">\\n                <img class=\"lazyload\" src=\"./images/default-pic.jpg\" data-src=\"${e.picUrl}\">\\n                <span class=\"icon icon_play\"></span>\\n            </div>\\n            <div class=\"list-title\">${e.Ftitle}</div>\\n        </div>`).join(\"\")}renderSong(e){this.$el.querySelector(\".song .list\").innerHTML=e.map(e=>`<div class=\"list-item\">\\n                <div class=\"list-media\">\\n                    <img class=\"lazyload\" src=\"./images/default-pic.jpg\" data-src=\"${e.picUrl}\">\\n                    <span class=\"icon icon_play\"></span>\\n                </div>\\n                <div class=\"list-title\">${e.songListDesc}</div>\\n            </div>`).join(\"\")}}(document.querySelector(\"#rec-view\")).launch(),new class{constructor(e){this.$el=e}launch(){return fetch(n).then(e=>e.json()).then(e=>this.renderTopList(e.data.topList)),this}renderTopList(e){this.$el.querySelector(\".topList\").innerHTML=e.map(e=>`<li class=\"list-item\">\\n                <div class=\"list-media\">\\n                    <a href=\"#\">\\n                        <img data-src=\"${e.picUrl}\" class=\"lazyload\">\\n                    </a>\\n                </div>\\n                <div class=\"list-title\">\\n                    <div class=\"title\">\\n                        <h3>${e.topTitle}</h3>\\n                        <p>1<span>${e.songList[0].songname}</span>-${e.songList[0].singername}</p>\\n                        <p>2<span>${e.songList[1].songname}</span>-${e.songList[1].singername}</p>\\n                        <p>3<span>${e.songList[2].songname}</span>-${e.songList[2].singername}</p>\\n                    </div>\\n                </div>\\n            </li>`).join(\"\"),r(this.$el.querySelectorAll(\".lazyload\"))}}(document.querySelector(\"#rank-view\")).launch(),new class{constructor(e){this.$el=e,this.$input=this.$el.querySelector(\"#search\"),this.$input.addEventListener(\"keyup\",this.onKeyUp.bind(this)),this.$input.addEventListener(\"input\",this.oninput.bind(this)),this.keyword=\"\",this.$songs=document.querySelector(\"#song-list\"),this.page=1,this.songs=[],this.nomore=!1,this.perpage=20,this.fetching=!1,this.onscroll=this.onScroll.bind(this),window.addEventListener(\"scroll\",this.onscroll)}onScroll(e){this.nomore||document.documentElement.clientHeight+pageYOffset>document.body.scrollHeight-50&&this.search(this.keyword,this.page+1)}oninput(e){if(!e.target.value)return this.reset()}onKeyUp(e){let s=e.target.value;13===e.keyCode&&this.search(s)}reset(){this.page=1,this.keyword=\"\",this.songs=[],this.$songs.innerHTML=\"\"}search(e,s){this.fetching||(this.fetching=!0,this.keyword=e,this.$songs.insertAdjacentHTML(\"beforeend\",'<div class=\"searching\"><img src=\"../images/icon_loading.png\"><span>正在加载更多...</span></div>'),fetch(`https://qq-music-api.now.sh/search?keyword=${this.keyword}&page=${s||this.page}`).then(e=>e.json()).then(e=>(this.page=e.data.song.curpage,this.nomore=\"no results\"===e.message,this.songs.push(...e.data.song.list),e.data)).then(e=>this.append(e)).then(()=>{this.fetching=!1}))}append(e){if(e.zhida.songnum){let s=`\\n            <a class=\"song-item\" href=\"#\">\\n                <div class=\"artist-image\"><img src=\"https://y.gtimg.cn/music/photo_new/T001R68x68M000${e.zhida.singermid}.jpg?max_age=2592000\"></div>\\n                <div class=\"song-name ellipsis\">${e.zhida.singername}</div>\\n                <div class=\"song-artist ellipsis\"><span>单曲：${e.zhida.songnum}</span><span>专辑：${e.zhida.albumnum}</span></div>\\n            </a>`;this.$songs.insertAdjacentHTML(\"beforeend\",s)}let s=e.song.list.map(e=>`\\n            <a class=\"song-item\" \\n            href=\"#player?singer=${e.singer.map(e=>e.name).join(\" / \")}&albummid=${e.albummid}&songname=${e.songname}&songid=${e.songid}&duration=${e.interval}&songmid=${e.songmid}\">\\n                <div class=\"icon-image\"><img src=\"./images/search-sprite.png\"></div>\\n                <div class=\"song-name ellipsis\">${e.songname}</div>\\n                <div class=\"song-artist ellipsis\">${e.singer.map(e=>e.name).join(\" / \")}</div>\\n            </a>`).join(\"\");if(this.$songs.insertAdjacentHTML(\"beforeend\",s),this.nomore){let e=\"<p>已加载全部</p>\";this.$songs.insertAdjacentHTML(\"beforeend\",e)}this.$songs.querySelector(\".searching\").classList.add(\"hide\"),this.$songs.querySelector(\".searching.hide\").style.display=\"none\",this.$songs.querySelector(\".searching.hide\").classList.remove(\"searching\")}}(document.querySelector(\".search-view\"));let c=new class{constructor(e){this.$el=e,this.$el.addEventListener(\"click\",this),this.createAudio(),this.lyrics=new l(document.querySelector(\".player-lyrics\"),this.$audio),this.progress=new o(document.querySelector(\".progress\"))}createAudio(){this.$audio=document.createElement(\"audio\"),this.$audio.id=`player-${Math.floor(100*Math.random())}`,this.$audio.addEventListener(\"ended\",()=>{this.lyrics.reset(),this.progress.reset();let e=document.querySelector(\".icon-pause\");e&&(e.classList.add(\"icon-play\"),e.classList.remove(\"icon-pause\"))}),body.appendChild(this.$audio)}handleEvent(e){let s=e.target;switch(!0){case s.matches(\".icon-play\"):this.onPlay(s);break;case s.matches(\".icon-pause\"):this.onPause(s);break;case s.matches(\"#icon-list\"):this.hide(s);break;case s.matches(\"#button\"):this.hide(s.parentNode)}}onPause(e){this.$audio.pause(),this.progress.pause(),this.lyrics.pause(),e.classList.add(\"icon-play\"),e.classList.remove(\"icon-pause\")}onPlay(e){this.$audio.play(),this.progress.start(),this.lyrics.start(),e.classList.add(\"icon-pause\"),e.classList.remove(\"icon-play\")}hide(e){e.parentNode.parentNode.classList.remove(\"show\"),document.querySelector(\"#body\").classList.remove(\"all-load\")}play(e={}){if(!e)return;this.$el.querySelector(\".album-image\").src=`https://y.gtimg.cn/music/photo_new/T002R150x150M000${e.albummid}.jpg`,this.$el.querySelector(\".background-image\").style.backgroundImage=`url(\"https://y.gtimg.cn/music/photo_new/T002R150x150M000${e.albummid}.jpg\")`,this.$el.querySelector(\".song-name\").innerText=`${e.songname}`,this.$el.querySelector(\".song-artist\").innerText=`${e.singer}`,this.progress.reset(e.duration);let s=document.querySelector(\".icon-pause\");s&&(s.classList.add(\"icon-play\"),s.classList.remove(\"icon-pause\")),e.songid&&(this.$audio.src=`http://ws.stream.qqmusic.qq.com/C100${e.songmid}.m4a?fromtag=0&guid=126548448`,fetch(`https://qq-music-api.now.sh/lyrics?id=${e.songid}}`).then(e=>e.json()).then(e=>e.lyric).then(e=>this.lyrics.reset(e)).catch(()=>{})),this.show()}show(){this.$el.classList.add(\"show\"),document.querySelector(\"#body\").classList.add(\"all-load\")}}(document.querySelector(\"#music-player\"));function d(){if(/^#player\\?.+/.test(location.hash)){let e=location.hash.indexOf(\"?\")+1,s=decodeURIComponent(location.hash).slice(e).match(/(\\w+)=([^&]+)/g).reduce((e,s)=>{let t=s.split(\"=\");return e[t[0]]=t[1],e},{});c.play(s)}}function h(){new Swiper(\".swiper-container\",{slidesPerView:1,centeredSlides:!0,autoplay:{delay:2500,disableOnInteraction:!1},loop:!0,pagination:{el:\".swiper-pagination\",clickable:!0},navigation:{nextEl:\".swiper-button-next\",prevEl:\".swiper-button-prev\"}})}document.querySelector(\"#play-button\").addEventListener(\"click\",()=>{c.show()}),d(),window.addEventListener(\"hashchange\",d)}]);","extractedComments":[]}